{% extends "base.html" %}

{% block title %}樂透管理{% endblock %}

{% block lotteryButton %}
	<li class="active"><a href="/lottery">樂透管理</a></li>
{% endblock %}
{% block content %}
	<label>期數(開獎日期)：<input type="date" id="periodAddInput"></label>
	<button type="button" class="btn btn-default" onclick="createLottery()">開獎</button>

	<div class="panel panel-success">
		<div class="panel-heading">
			<h3 class="panel-title">最近一次開獎紀錄</h3>
		</div>
		<div class="panel-body">
			<table class="table table-hover">
				<thead>
			        <tr>
			          <th>期數</th>
			          <th>號碼一</th>
			          <th>號碼二</th>
			          <th>號碼三</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<td id="periodLast"></td>
			    	<td id="firstLast"></td>
			    	<td id="secondLast"></td>
			    	<td id="thirdLast"></td>
			    </tbody>
			</table>
		</div>
	</div>
{% endblock %}
{% block script %}
	<script type="text/javascript">
		var myFirebaseRef = new Firebase('https://lottery-72c58.firebaseio.com/');
		Date.prototype.toDateInputValue = (function() {
		    var local = new Date(this);
		    local.setMinutes(this.getMinutes() - this.getTimezoneOffset());
		    return local.toJSON().slice(0,10);
		});
		document.getElementById('periodAddInput').value = new Date().toDateInputValue();
		function createLottery() {
			var period = document.getElementById('periodAddInput').value;
			var newAddLottery = myFirebaseRef.push({
				"Period": period,
				"Numbers": {
					"First": Math.floor(Math.random()*(9-0+1)+0),
					"Second": Math.floor(Math.random()*(9-0+1)+0),
					"Third": Math.floor(Math.random()*(9-0+1)+0)
				}
			});
		}

		myFirebaseRef.orderByPriority().limitToLast(1).on("child_added", function(snapshot, prevChildKey) {
			var lottery = snapshot.val();
			displayCoupon(lottery.Period, lottery.Numbers.First, lottery.Numbers.Second, lottery.Numbers.Third);
		});

		function displayCoupon(period, first, second, third) {
			//document.getElementById("markDiv").innerHTML = "<tr><td>" + title + "</td><td>" + context + "</td><td>" + latitude + "</td><td>" + longitude + "</td></tr>";
			document.getElementById("periodLast").innerHTML = period;
			document.getElementById("firstLast").innerHTML = first;
			document.getElementById("secondLast").innerHTML = second;
			document.getElementById("thirdLast").innerHTML = third;
		}
	</script>
{% endblock %}