{% extends "base.html" %}

{% block title %}會員管理{% endblock %}

{% block memberButton %}
	<li class="active"><a href="/member">會員管理</a></li>
{% endblock %}
{% block content %}
	<button type="button" class="btn btn-default" onclick="createMember()">新增測試會員</button>

	<div class="panel panel-success">
		<div class="panel-heading">
			<h3 class="panel-title">末筆成功新增會員</h3>
		</div>
		<div class="panel-body">
			<table class="table table-hover">
				<thead>
			        <tr>
			          <th>Facebook ID</th>
			          <th>暱稱</th>
			          <th>擁有點數</th>
			          <th>照片</th>
			          <th>預設地區</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<td id="idLast"></td>
			    	<td id="nicknameLast"></td>
			    	<td id="pointsLast"></td>
			    	<td id="photoLast"></td>
			    	<td id="zoneLast"></td>
			    </tbody>
			</table>
		</div>
	</div>
{% endblock %}
{% block script %}
	<script type="text/javascript">
		var myFirebaseRef = new Firebase('https://member-139bd.firebaseio.com/');
		function createMember() {
			var newAddCoupon = myFirebaseRef.push({
				"Facebook_ID": 111111111111111,
				"Birthday": {
					"Month": 12,
					"Day": 12
				},
				"Nickname": "Test",
				"Owned_Points": 100,
				"Owned_Coupons": {
					"Coupon_ID": "-KMhXFTBRXVKTUICgmYg",
					"Information": "Test",
					"Due_Date": 20160725
				},
				"Lottery_Numbers": {
					"Period": 20160722,
					"Numbers": {
						"First": 5,
						"Second": 2,
						"Third": 1
					}
				},
				"Favorite_Vendors": {
					"Vendor_ID": "-KMry4edOHypUOiSS9bj"
				},
				"Photos": {
					"Photo_ID": "UkqwHMT"
				},
				"Default_Zone": 106,
				"Share_Times": 5
			});
		}

		myFirebaseRef.orderByPriority().limitToLast(1).on("child_added", function(snapshot, prevChildKey) {
			var member = snapshot.val();
			displayCoupon(member.Facebook_ID, member.Nickname, member.Owned_Points, member.Photos.Photo_ID, member.Default_Zone);
		});

		function displayCoupon(fb_ID, name, points, photos, zone) {
			//document.getElementById("markDiv").innerHTML = "<tr><td>" + title + "</td><td>" + context + "</td><td>" + latitude + "</td><td>" + longitude + "</td></tr>";
			document.getElementById("idLast").innerHTML = fb_ID;
			document.getElementById("nicknameLast").innerHTML = name;
			document.getElementById("pointsLast").innerHTML = points;
			var photoLink = "http://imgur.com/" + photos;
			document.getElementById("photoLast").innerHTML = "<a href='" + photoLink + "'>圖片</a>";
			document.getElementById("zoneLast").innerHTML = zone;
		}
	</script>
{% endblock %}