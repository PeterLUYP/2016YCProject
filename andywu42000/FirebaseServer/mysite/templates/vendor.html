{% extends "base.html" %}

{% block title %}新增攤販{% endblock %}

{% block styleArea %}
	<style>
	label textarea{
 		vertical-align: top;
	}
	</style>
{% endblock %}

{% block vendorButton %}
	<li class="active"><a href="/vendor">攤販管理</a></li>
{% endblock %}
{% block content %}
	<div class="panel panel-default">
		<div class="panel-heading">
			<h3 class="panel-title">新增攤販</h3>
		</div>
		<div class="panel-body">
			<label><p>攤販資訊：<p>
				<label>攤販名稱：<input type="text" id="nameAddInput"></input></label>
				<label>攤販電話：<input type="text" id="phoneAddInput"></input></label>
				<label>攤販介紹：<textarea rows="5" cols="30"id="introductionAddInput"></textarea></label>
				<label>相片(imgur後7碼，不含.jpg)：<input type="text" id="photoAddInput"></input></label>
			</label>
			<label><p>攤販地點：<p>
				<label>地址：<input type="text" id="addressAddInput"></input></label>
				<label>郵遞區號：<input type="text" id="zipAddInput"></input></label>
				<label>緯度：<input type="text" id="latiAddInput" placeholder="Float Only"></input></label>
				<label>經度：<input type="text" id="longiAddInput" placeholder="Float Only"></input></label>
			</label>
			<label><p>營業時間：<p>
				<label>週日：<input type="time" id="sunOpenAddInput">~<input type="time" id="sunCloseAddInput"></label>
				<label>週一：<input type="time" id="monOpenAddInput">~<input type="time" id="monCloseAddInput"></label>
				<label>週二：<input type="time" id="tueOpenAddInput">~<input type="time" id="tueCloseAddInput"></label>
				<label>週三：<input type="time" id="wedOpenAddInput">~<input type="time" id="wedCloseAddInput"></label>
				<label>週四：<input type="time" id="thuOpenAddInput">~<input type="time" id="thuCloseAddInput"></label>
				<label>週五：<input type="time" id="friOpenAddInput">~<input type="time" id="friCloseAddInput"></label>
				<label>週六：<input type="time" id="satOpenAddInput">~<input type="time" id="satCloseAddInput"></label>
				<label>備註：<input type="text" id="remarkAddInput"></input></label>
			</label>
			<label><p>攤販類型：
				<select id="typeAddInput">
					<option value=1>食物</option>
					<option value=2>飲料</option>
					<option value=3>其它</option>
				</select>
			</label>
			<button type="button" onclick="addNewVendor()" class="btn btn-default" id="addNewVendorBtn">新增</button>
		</div>
	</div>
	<div class="panel panel-success">
		<div class="panel-heading">
			<h3 class="panel-title">末筆成功新增攤販</h3>
		</div>
		<div class="panel-body">
			<table class="table table-hover">
				<thead>
			        <tr>
			          <th>攤販名稱</th>
			          <th>攤販電話</th>
			          <th>攤販類型</th>
			          <th>郵遞區號</th>
			          <th>緯度</th>
			          <th>經度</th>
			          <th>相片</th>
			        </tr>
			    </thead>
			    <tbody>
			    	<td id="nameLast"></td>
			    	<td id="phoneLast"></td>
			    	<td id="typeLast"></td>
			    	<td id="zipLast"></td>
			    	<td id="latiLast"></td>
			    	<td id="longiLast"></td>
			    	<td id="photoLast"></td>
			    </tbody>
			</table>
		</div>
	</div>
{% endblock %}
{% block script %}
	<script type="text/javascript">
		var myFirebaseRef = new Firebase('https://vendor-5acbc.firebaseio.com/Vendors');
		function addNewVendor() {
			var name = $('#nameAddInput').val();
			var phone = $('#phoneAddInput').val();
			var introduction = $('#introductionAddInput').val();
			var photo = $('#photoAddInput').val();
			var address = $('#addressAddInput').val();
			var zip = $('#zipAddInput').val();
			var lati = parseFloat($('#latiAddInput').val());
			var longi = parseFloat($('#longiAddInput').val());
			var sunOpen = $('#sunOpenAddInput').val();
			var sunClose = $('#sunCloseAddInput').val();
			var monOpen = $('#monOpenAddInput').val();
			var monClose = $('#monCloseAddInput').val();
			var tueOpen = $('#tueOpenAddInput').val();
			var tueClose = $('#tueCloseAddInput').val();
			var wedOpen = $('#wedOpenAddInput').val();
			var wedClose = $('#wedCloseAddInput').val();
			var thuOpen = $('#thuOpenAddInput').val();
			var thuClose = $('#thuCloseAddInput').val();
			var friOpen = $('#friOpenAddInput').val();
			var friClose = $('#friCloseAddInput').val();
			var satOpen = $('#satOpenAddInput').val();
			var satClose = $('#satCloseAddInput').val();
			var remark = $('#remarkAddInput').val();
			var type = parseInt($('#typeAddInput').val());
			var newAddvendor = myFirebaseRef.push({
				"Location": {
					"Address": address,
					"ZIP": zip,
					"Latitude": lati,
					"Longitude": longi
				},
				"Information": {
					"Name": name,
					"Phone": phone,
					"Introduction": introduction
				},
				"Open_Days": {
					"Sun": {
						"Open_At": sunOpen,
						"Close_At": sunClose
					},
					"Mon": {
						"Open_At": monOpen,
						"Close_At": monClose
					},
					"Tue": {
						"Open_At": tueOpen,
						"Close_At": tueClose
					},
					"Wed": {
						"Open_At": wedOpen,
						"Close_At": wedClose
					},
					"Thu": {
						"Open_At": thuOpen,
						"Close_At": thuClose
					},
					"Fri": {
						"Open_At": friOpen,
						"Close_At": friClose
					},
					"Sat": {
						"Open_At": satOpen,
						"Close_At": satClose
					},
					"Remark": remark
				},
				"Types": {
					"Type_ID": type
				},
				"Popularity": 0,
				"Comments": null,
				"Focus": false,
				"Photos": {
					"Photo_ID": photo
				}
			});
			//var newAddMarkId = newAddMark.key();
			$('#nameAddInput').val("");
			$('#phoneAddInput').val("");
			$('#introductionAddInput').val("");
			$('#photoAddInput').val("");
			$('#addressAddInput').val("");
			$('#zipAddInput').val("");
			$('#latiAddInput').val("");
			$('#longiAddInput').val("");
			$('#sunOpenAddInput').val("");
			$('#sunCloseAddInput').val("");
			$('#monOpenAddInput').val("");
			$('#monCloseAddInput').val("");
			$('#tueOpenAddInput').val("");
			$('#tueCloseAddInput').val("");
			$('#wedOpenAddInput').val("");
			$('#wedCloseAddInput').val("");
			$('#thuOpenAddInput').val("");
			$('#thuCloseAddInput').val("");
			$('#friOpenAddInput').val("");
			$('#friCloseAddInput').val("");
			$('#satOpenAddInput').val("");
			$('#satCloseAddInput').val("");
			$('#remarkAddInput').val("");
		};
		myFirebaseRef.orderByPriority().limitToLast(1).on("child_added", function(snapshot, prevChildKey) {
			var vendor = snapshot.val();
			displayVendor(vendor.Information.Name, vendor.Information.Phone, vendor.Types.Type_ID, vendor.Location.ZIP, vendor.Location.Latitude, vendor.Location.Longitude, vendor.Photos.Photo_ID);
		});
		/**myFirebaseRef.orderByChild("longitude").equalTo(121.5).on("child_added", function(snapshot) {
			var mark = snapshot.val();
			displayMark(mark.title, mark.context, mark.latitude, mark.longitude);
		});*/

		function displayVendor(name, phone, type, zip, lati, longi, photos) {
			document.getElementById("nameLast").innerHTML = name;
			document.getElementById("phoneLast").innerHTML = phone;
			var typeOpt="";
			if(type==1){typeOpt = "食物";}
			else if(type==2){typeOpt = "飲料";}
			else if(type==3){typeOpt = "其它";}
			document.getElementById("typeLast").innerHTML = typeOpt;
			document.getElementById("zipLast").innerHTML = zip;
			document.getElementById("latiLast").innerHTML = lati;
			document.getElementById("longiLast").innerHTML = longi;
			var photoLink = "http://imgur.com/" + photos;
			document.getElementById("photoLast").innerHTML = "<a href='" + photoLink + "'>圖片</a>";
		}
	</script>
{% endblock %}